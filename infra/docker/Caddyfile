{$DOMAIN:egouda.xyz} {
    # WebSocket endpoint - proxy to backend
    @websocket {
        path /ws/*
    }
    reverse_proxy @websocket backend:8000

    # All other traffic goes to frontend
    reverse_proxy localhost:3000

    log {
        output file /var/log/caddy/access.log
    }

    header {
        -Server
        X-Content-Type-Options nosniff
        X-Frame-Options DENY
        Referrer-Policy strict-origin-when-cross-origin
        X-XSS-Protection "1; mode=block"
    }
}

# www redirect
www.{$DOMAIN:egouda.xyz} {
    redir https://{$DOMAIN:egouda.xyz}{uri} permanent
}
